[![Test](https://github.com/iamelevich/pocketbase-plugin-proxy/actions/workflows/test.yml/badge.svg)](https://github.com/iamelevich/pocketbase-plugin-proxy/actions/workflows/test.yml)
[![codecov](https://codecov.io/github/iamelevich/pocketbase-plugin-proxy/graph/badge.svg?token=MAXWWCGHWD)](https://codecov.io/github/iamelevich/pocketbase-plugin-proxy)

<!-- TOC -->
* [Overview](#overview)
  * [Requirements](#requirements)
  * [Installation](#installation)
  * [Example](#example)
* [pocketbase\_plugin\_proxy](#pocketbasepluginproxy)
  * [Index](#index)
  * [func DefaultSkipper](#func-defaultskipper)
  * [type Options](#type-options)
  * [type Plugin](#type-plugin)
    * [func MustRegister](#func-mustregister)
    * [func Register](#func-register)
    * [func \(\*Plugin\) SetSkipper](#func-plugin-setskipper)
    * [func \(\*Plugin\) Validate](#func-plugin-validate)
* [Contributing](#contributing)
  * [Process](#process)
  * [Development setup](#development-setup)
  * [Testing](#testing)
  * [Linting](#linting)
  * [Docs update in README](#docs-update-in-readme)
<!-- TOC -->

# Overview

This plugin allow proxify requests to other host. It can be useful if you want to use separate server as frontend but use one address for both frontend and backend.

## Requirements

- [Pocketbase](https://github.com/pocketbase/pocketbase)

## Installation

```bash
go get github.com/iamelevich/pocketbase-plugin-proxy
```

## Example

You can check examples in [examples folder](/examples)

```go
package main

import (
	"log"

	proxyPlugin "github.com/iamelevich/pocketbase-plugin-proxy"
	"github.com/pocketbase/pocketbase"
)

func main() {
	app := pocketbase.New()

	// Setup proxy plugin
	proxyPlugin.MustRegister(app, &proxyPlugin.Options{
		Enabled: true,
		Url:     "http://localhost:3000",
	})

	if err := app.Start(); err != nil {
		log.Fatal(err)
	}
}
```

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pocketbase\_plugin\_proxy

```go
import "github.com/iamelevich/pocketbase-plugin-proxy"
```

## Index

- [func DefaultSkipper\(c echo.Context\) bool](<#DefaultSkipper>)
- [type Options](<#Options>)
- [type Plugin](<#Plugin>)
  - [func MustRegister\(app core.App, options \*Options\) \*Plugin](<#MustRegister>)
  - [func Register\(app core.App, options \*Options\) \(\*Plugin, error\)](<#Register>)
  - [func \(p \*Plugin\) SetSkipper\(skipper middleware.Skipper\)](<#Plugin.SetSkipper>)
  - [func \(p \*Plugin\) Validate\(\) error](<#Plugin.Validate>)


<a name="DefaultSkipper"></a>
## func [DefaultSkipper](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L16>)

```go
func DefaultSkipper(c echo.Context) bool
```

DefaultSkipper skip proxy middleware for requests, where path starts with /\_/ or /api/.

<a name="Options"></a>
## type [Options](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L21-L32>)

Options defines optional struct to customize the default plugin behavior.

```go
type Options struct {
    // Enabled defines if proxy should be enabled.
    Enabled bool

    //Url to the target.
    //
    //Only http and https links are supported.
    Url string

    // Are proxy logs enabled?
    ProxyLogsEnabled bool
}
```

<a name="Plugin"></a>
## type [Plugin](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L34-L46>)



```go
type Plugin struct {
    // contains filtered or unexported fields
}
```

<a name="MustRegister"></a>
### func [MustRegister](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L130>)

```go
func MustRegister(app core.App, options *Options) *Plugin
```

MustRegister is a helper function that registers plugin and panics if error occurred.

<a name="Register"></a>
### func [Register](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L139>)

```go
func Register(app core.App, options *Options) (*Plugin, error)
```

Register registers plugin.

<a name="Plugin.SetSkipper"></a>
### func \(\*Plugin\) [SetSkipper](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L95>)

```go
func (p *Plugin) SetSkipper(skipper middleware.Skipper)
```

SetSkipper set skipper function that should return true if that route shouldn't be proxied.

If not set, the DefaultSkipper is used:

If set \- you should also control the middleware behavior for /\_/ and /api/ routes.

Example:

```
plugin := proxyPlugin.MustRegister(app, &proxyPlugin.Options{
	Enabled: true,
	Url:     "http://localhost:3000",
})
plugin.SetSkipper(func(c echo.Context) bool {
	return c.Request().URL.Path == "/my-super-secret-route"
})
```

<a name="Plugin.Validate"></a>
### func \(\*Plugin\) [Validate](<https://github.com/iamelevich/pocketbase-plugin-proxy/blob/master/plugin.go#L49>)

```go
func (p *Plugin) Validate() error
```

Validate plugin options. Return error if some option is invalid.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->

# Contributing

This pocketbase plugin is free and open source project licensed under the [MIT License](LICENSE.md).
You are free to do whatever you want with it, even offering it as a paid service.

## Process

- Fork the repo
- Create a new branch
- Make your changes
- Create a pull request
- Wait for review
- Make changes if needed
- Merge
- Celebrate :)

## Development setup

- Install [asdf](https://asdf-vm.com/#/core-manage-asdf-vm) and plugins for tools listed in [.tool-versions](.tool-versions) file.
- This repo also uses [asdf-direnv](https://github.com/asdf-community/asdf-direnv). Install it and run `direnv allow` in the repo root.
- Setup `pre-commit` hooks with `pre-commit install -t commit-msg -t pre-commit`

## Testing

- Run `task test` to run tests
- Run `task test:report` to run tests and get coverage report in `./coverage.html`

## Linting

- Run `task lint` to run linters

## Docs update in README

- Run `task docs` to update docs in README (it will also install [gomarkdoc](https://github.com/princjef/gomarkdoc))
